// Latch fetched instruction on processor clock for stable decode
genvar j; // Use 'j' to avoid conflict with the existing 'i'
generate
    for (j = 0; j < 32; j = j + 1) begin : instr_reg_gen
        dffe_ref instr_dffe_j (
            .q(instr[j]),
            .d(q_imem[j]),
            .clk(clock),
            .en(1'b1),
            .clr(reset)
        );
    end
endgenerate


// fixed the i_mem swap issue